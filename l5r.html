
<div class="container">
  <div class="menu">
    <div class="logo"></div>
    <div class="menuMain">
      <label>
        <input name="attr_activeTab" value="1" type="radio" checked><span title="Personnage"></span>
      </label>
      <label>
        <input name="attr_activeTab" value="2" type="radio"><span title="Compétences"></span>
      </label>
      <label>
        <input name="attr_activeTab" value="3" type="radio"><span title="Combat"></span>
      </label>
      <label>
        <input name="attr_activeTab" value="4" type="radio"><span title="(Dés) Avantages"></span>
      </label>
      <label>
        <input name="attr_activeTab" value="5" type="radio"><span title="École &amp; Techniques"></span>
      </label>
      <label>
        <input name="attr_activeTab" value="6" type="radio"><span title="Magie"></span>
      </label>
      <label>
        <input name="attr_activeTab" value="7" type="radio"><span title="Histoire &amp; Relations"></span>
      </label>
      <label>
        <input name="attr_activeTab" value="8" type="radio"><span title="Outremonde"></span>
      </label>
    </div>
    <div class="menuFooter">
      <label>
        <input name="attr_activeTab" value="0" type="radio"><span title="Configuration"></span>
      </label><span>&copy; Calmacil 2022</span>
    </div>
  </div>
  <div class="main-container">
    <div class="dicebox">
      <div class="col3">
        <h3>Explose sur...</h3>
        <div class="explodeOnWrapper">
          <label>
            <input name="attr_explodeOn" value="7" type="radio"><span title="7"></span>
          </label>
          <label>
            <input name="attr_explodeOn" value="8" type="radio"><span title="8"></span>
          </label>
          <label>
            <input name="attr_explodeOn" value="9" type="radio"><span title="9"></span>
          </label>
          <label>
            <input name="attr_explodeOn" value="10" type="radio" checked><span title="10"></span>
          </label>
        </div>
      </div>
      <div class="col3">
        <label>
          <input name="attr_hasFocus" value="1" type="checkbox"><span>Spécialité</span>
        </label>
        <label>
          <input name="attr_askDiff" value="1" type="checkbox"><span>Demander diff?</span>
        </label>
      </div>
      <div class="col3">
        <label for="rollMod"><span>Modif. ?</span>
          <input name="attr_rollMod" type="text" value="" id="rollMod">
        </label><span>Jet libre
          <button name="act_freeRoll" type="action" value="{{pool=?{Formule ?}}}"></button></span>
      </div>
    </div>
    <input name="attr_activeTab" type="hidden" value="1">
    <div class="tab tab1">
      <div class="col2T1" id="identity">
        <label for="character_name"><span>Nom:</span>
          <input name="attr_character_name" type="text" value="" id="character_name">
        </label>
        <label for="clan"><span>Clan:</span>
          <input name="attr_clan" type="text" value="" id="clan">
        </label>
        <label for="family"><span>Famille:</span>
          <input name="attr_family" type="text" value="" id="family">
        </label>
        <label for="genre"><span>Genre:</span>
          <input name="attr_genre" type="text" value="" id="genre">
        </label>
        <label for="age"><span>Âge:</span>
          <input name="attr_age" type="text" value="" id="age">
        </label>
          <div class="caracbar" id="caracs">
            <div class="elem">
              <label for="constitution"><span>Consti.
                  <button name="act_constitution" type="action" value="{{jet=[[@{constitution}d10k@{constitution}!10]]}}"></button></span>
                <input name="attr_constitution" type="number" value="2" id="constitution">
              </label>
              <label for="earth"><span>Terre</span>
                <input name="attr_earth" type="number" value="2" id="earth" readonly>
              </label>
              <label for="will"><span>Volonté</span>
                <input name="attr_will" type="number" value="2" id="will">
              </label>
            </div>
            <div class="elem">
              <label for="reflex"><span>Réflexes</span>
                <input name="attr_reflex" type="number" value="2" id="reflex">
              </label>
              <label for="air"><span>Air</span>
                <input name="attr_air" type="number" value="2" id="air" readonly>
              </label>
              <label for="awareness"><span>Intuition</span>
                <input name="attr_awareness" type="number" value="2" id="awareness">
              </label>
            </div>
            <div class="elem">
              <label for="strength"><span>Force</span>
                <input name="attr_strength" type="number" value="2" id="strength">
              </label>
              <label for="water"><span>Eau</span>
                <input name="attr_water" type="number" value="2" id="water" readonly>
              </label>
              <label for="perception"><span>Percep.</span>
                <input name="attr_perception" type="number" value="2" id="perception">
              </label>
            </div>
            <div class="elem">
              <label for="agility"><span>Agilité</span>
                <input name="attr_agility" type="number" value="2" id="agility">
              </label>
              <label for="fire"><span>Feu</span>
                <input name="attr_fire" type="number" value="2" id="fire" readonly>
              </label>
              <label for="intelligence"><span>Intel.</span>
                <input name="attr_intelligence" type="number" value="2" id="intelligence">
              </label>
            </div>
            <div class="elem elemVoid">
              <label for="void"><span>Vide</span>
                <input name="attr_void" type="number" value="2" id="void">
              </label>
              <label for="voidUsed"><span>Utilisé</span>
                <input name="attr_voidUsed" type="number" value="0" id="voidUsed">
              </label>
            </div>
          </div>
      </div>
      <div class="col3"><span>HonorBox</span></div>
    </div>
    <div class="tab tab2">
      <h1>Compétences</h1>
    </div>
    <div class="tab tab3">
      <h1>Combat</h1>
    </div>
    <div class="tab tab4">
      <h1>Avantages et désavantages</h1>
    </div>
    <div class="tab tab5">
      <h1>École et Techniques</h1>
    </div>
    <div class="tab tab6">
      <h1>Magie</h1>
    </div>
    <div class="tab tab7">
      <h1>Histoire et Relations</h1>
    </div>
    <div class="tab tab8">
      <h1>Outremonde</h1>
    </div>
    <div class="tab tab0">
      <h1>Configuration</h1>
    </div>
  </div>
</div>
<rolltemplate class="sheet-rolltemplate-base">
  <div class="sheet-header">
    <h1>{{charname}}</h1>
  </div>
  <div class="sheet-results">
    <h4>{{title}} : {{displayRoll}}</h4>
    <h4>{{roll}}</h4>
  </div>
</rolltemplate>
<script type="text/worker">
  on('sheet:opened change:constitution change:will change:awareness change:reflex change:force change:perception change:agility change:intelligence', function()
{
    getAttrs(['constitution', 'will', 'awareness', 'reflex', 'force', 'perception', 'agility', 'intelligence'], function(v)
    {
        setAttrs({
            earth: Math.min(v['constitution'], v['will']),
            air: Math.min(v['reflex'], v['awareness']),
            water: Math.min(v['force'], v['perception']),
            fire: Math.min(v['agility'], v['intelligence'])
        })
    })
});function doRoll(pool, kept, mod, title, template='base')
{
    var rollString = `&{template:${template}} `
    getAttrs(['character_name', 'hasFocus', 'explodeOn'], function(v)
    {
        rollString += `{{charname=${v.character_name}}} `

        rollString += `{{roll=[[{`
        for (let i = 0; i < pool; i++) {
            if (i) rollString += ', '
            rollString += `1d10!>${v.explodeOn}`
            if ("1" === v.hasFocus)
                rollString += `r1`
        }
        rollString += `}k${kept}+${mod}]]}} `

        rollString += `{{title=${title}}} `

        rollString += `{{displayRoll=${pool}g${kept}`
        if (mod > 0)
            rollString += `+${mod}`
        else if (mod < 0)
            rollString += mod
        rollString += `}} `

        console.warn(rollString)
        startRoll(rollString, function(result) {
            // Do stuff later
            finishRoll(result.rollId)
        })

    })
}

on('clicked:constitution', function()
{
    console.log("COUCOU")
});

on('clicked:freeRoll', function()
{
    doRoll(8, 3, 0, 'Ramoloss')
})
</script>